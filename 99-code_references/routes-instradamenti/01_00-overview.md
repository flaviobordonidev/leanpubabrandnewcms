# <a name="top"></a> Cap *routes-instradamenti*.1 - Instradamenti

Introduciamo gli instradamenti.



## Risorse interne

- 01-base/03-mockups/01-mockups
- 01-base/07-authentication/03-devise-users-seeds
- 01-base/11-eg_pages/07-eg_posts-protected 



## Risorse esterne

- [Rails: routing](https://guides.rubyonrails.org/routing.html)
- [Understanding Rails Routes 1](https://medium.com/podiihq/understanding-rails-routes-and-restful-design-a192d64cbbb5)
- [Understanding Rails Routes 2](https://richonrails.com/articles/understanding-rails-routing)



## Understanding Rails Routes and RESTful Design

A router in Rails is a directing module that recognizes browser URLs and dispatches them to the controller actions requested. To make it simple, when you enter a url in your domain, the rails router will know which controller and action to handle your url.

descrizione               | codice
------------------------- | ------------------------
Browser URL               | /pages/home
routes.rb                 | get "pages/home"
pages_controller.rb       | def home ... end
views/pages/home.html.erb | ...


```ruby
  get "pages/home", to: "pages#home”
```



## Instradamento di root

Quando non inseriamo nessun *path* nell'url: `http://192.168.64.3:3000/`

***code 01 - .../config/routes.rb - line:3***

```ruby
  # GET /
  root 'my_controller#my_action'
```

Esegue l'azione `my_action` del controller `my_controller_controller`.



## Instradamento GET

Quando inseriamo un *path* nell'url: `http://192.168.64.3:3000/pages/page_a`

***code 02 - .../config/routes.rb - line:3***

```ruby
  # GET /my_controller/my_action
  get 'my_controller#my_action'
```

Esegue l'azione `my_action` del controller `my_controller_controller`.

Se vogliamo eseguire stessa azione dello stesso controller ma con path: `/my_page`.

url: `http://192.168.64.3:3000/my_page`.

```ruby
  # GET /my_page
  get "/my_page", to: "my_controller#my_action"
```



## Verifichiamo instradamenti da console

Tutti gli instradamenti

```bash
$ rails routes
```

Filtriamo per i soli utenti

```bash
$ rails routes | egrep "user"
```








## Rails RESTful Design

routes.rb           : resources :users


resources :users, only: [:index, :new, :create]


---
resources :users, :books, :messages

è uguale a:

resources :users
resources :books
resources :messages
---




## Controller Namespace and Routing


namespace :admin do 
 resources :articles, :comments
end


/admin/articles




## Naming Routes

Instead of using raw urls generated by Rails app, Rails allows you to refer to routes by names. For example, the following will create a logout_path or logout_url a named helpers in your application.

get “sessions/destroy”, as: :logout 

To refer to this route anywhere in your application you can write:

logout_path

Beauty of this being that you can always change the controller and action without refactoring so much code in the views and other controllers.

* http://guides.rubyonrails.org/routing.html#controller-namespaces-and-routing




## Redirection

You can redirect any path to another path using the redirect helper in your router:

get ‘/stories’, to: redirect(‘/articles’)

Please note that default redirection is a 301 “Moved Permanently” redirect. Keep in mind that some web browsers or proxy servers will cache this type of redirect, making the old page inaccessible. 
You can use the :status option to change the response status:

get ‘/stories’, to: redirect(‘/articles’, status : 302)

This depicts a “Moved Temporarily” so the next time user requests for the resource the redirect will always occur. If we used the 301 then if a browser caches it as inaccessible then if a user tries to access the route for a second time the browser will not even make the request to our server assuming that the resources was permanently moved


