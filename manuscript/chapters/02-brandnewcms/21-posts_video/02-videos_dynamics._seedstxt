# Inseriamo il puntamento al video su youtube o vimeo




## Aggiungiamo il campo nel database

aggiungiamo sia il campo video_id che il campo select_midia alla tabella posts

* video_id      : string
* select_media  : integer -> youtube-video, vimeo-video, foto, audio, quote)


{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails g migration AddVideoIdAndSocialMediaToPosts video_id:string select_media:integer
~~~~~~~~

questo crea il migrate:

{title=".../db/migrate/xxx_add_video_id_and_social_media_to_posts.rb", lang=ruby, line-numbers=on, starting-line-number=1}
~~~~~~~~
class AddVideoIdAndSocialMediaToPosts < ActiveRecord::Migration[5.1]
  def change
    add_column :posts, :video_id, :string
    add_column :posts, :select_media, :integer
  end
end
~~~~~~~~

eseguiamo il migrate 

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ sudo service postgresql start
$ rails db:migrate
~~~~~~~~




## Aggiorniamo il controller

aggiungiamo i campi nella withelist di authors/posts

{title=".../db/controllers/authors/posts_controller.rb", lang=ruby, line-numbers=on, starting-line-number=84}
~~~~~~~~
      # Never trust parameters from the scary internet, only allow the white list through.
      def post_params
        params.require(:post).permit(:title, :body, :description, :author_id, :image, :incipit, :sharing_image, :sharing_description, :tag_list, :video_id, :select_media)
      end
~~~~~~~~




## Aggiorniamo la view

aggiungiamo i due campi nel partial form della cartella authors/posts

{title=".../app/views/authors/posts/_form.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=1}
~~~~~~~~
          <li class="list-group-item">
            <div class="field">
              <%= form.label :select_media %><!-- menu a cascata -->
              <%= form.text_field :select_media, id: :select_media, class: "form-control" %>
            </div>
          </li>
          <li class="list-group-item">
            <div class="field">
              <%= form.label :video_id %><!-- parte di URL youtube o vimeo che identifica il video -->
              <%= form.text_field :video_id, id: :video_id, class: "form-control" %>
            </div>
          </li>
~~~~~~~~

Al momento non inseriamo il menu a cascata per :select_media ma lo lasciamo numerico.

aggiungiamo sia il video youtube (video_id = 9kiLJCtjaHI) che il video vimeo sotto l'immagine nel post_single

{title=".../app/views/posts/_post_single.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=1}
~~~~~~~~
                <% if post.image.present? %>
                  <!-- Entry Image
                  ============================================= -->
                  <div class="entry-image">
                    <%= link_to image_path(post.image_url), target: "_blank" do %>
                      <%= image_tag post.image_url, alt: "Blog Single" %>
                    <% end %>

                    <iframe src='https://www.youtube.com/embed/<%= post.video_id %>?rel=0&autoplay=<%= params[:autoplay] || 0 %>' frameborder='0' allowfullscreen></iframe>
  									<iframe src="https://player.vimeo.com/video/87701971" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

                  </div><!-- .entry-image end -->
                <% end %>
~~~~~~~~

verifichiamo 

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails s -b $IP -p $PORT
~~~~~~~~




## Implementiamo il menu a cascata per modificare il media del post

Nel menu a cascata scegliamo se il nostro articolo (post) ha un'immagine, un video di youtube, un video di vimeo, un audio, ...
Nel campo archiviamo semplicemente un numero ma nel menu a cascata visualizziamo le corrispondenze. Evitiamo |enum| perché non è semplice gestire il multilingua. 
Evitiamo una nuova tabella con relazione uno-a-molti per tenere le cose semplici; tanto l'elenco è fisso e non varia.

{title=".../app/views/authors/posts/_form.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=1}
~~~~~~~~
              <%= form.select :select_media, h_options_for_media, {}, prompt: 'Scegline uno', class: 'form-control' %>
~~~~~~~~

{title=".../app/helpers/application_helper.rb", lang=ruby, line-numbers=on, starting-line-number=70}
~~~~~~~~
  def h_options_for_media
    [
      ["immagine",1],
      ["video youtube",2],
      ["video vimeo",3]
    ]
  end
~~~~~~~~




## Aggiorniamo la view

Impostiamo l'icona corrispondente alla scelta fatta in select_media



mostriamo solo o l'immagine o il video youtube o il video vimeo a seconda della scelta fatta in select_media

{title=".../app/views/posts/_post_single.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=24}
~~~~~~~~
                  <% if post.select_media == 1 %>
                    <li><a href="#"><i class="icon-camera-retro"></i></a></li>
                  <% elsif post.select_media == 2 or post.select_media == 3 %>
                    <li><a href="#"><i class="icon-film"></i></a></li>
                  <% end %>
~~~~~~~~

{title=".../app/views/posts/_post_single.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=31}
~~~~~~~~
                <% if post.select_media == 1 %> <!-- image -->
                  <% if post.image.present? %>
                    <!-- Entry Image
                    ============================================= -->
                    <div class="entry-image">
                      <!-- <a href="#"><img src="images/blog/full/1.jpg" alt="Blog Single"></a> -->
                      <!--<a href="#"><%#= image_tag "blog-full-1.jpg", alt: "Blog Single" %></a>-->
                      <!--<a href="#"><%#= image_tag @post.image_url, alt: "Blog Single" %></a>-->
                      <%= link_to image_path(post.image_url), target: "_blank" do %>
                        <%= image_tag post.image_url, alt: "Blog Single" %>
                      <% end %>
                    </div><!-- .entry-image end -->
                  <% end %>
                <% elsif post.select_media == 2 %> <!-- youtube -->
                  <% if post.video_id.present? %>
                    <!-- Entry Video
                    ============================================= -->
                    <div class="entry-image">
                      <iframe src='https://www.youtube.com/embed/<%= post.video_id %>?rel=0&autoplay=<%= params[:autoplay] || 0 %>' frameborder='0' allowfullscreen></iframe>
                    </div><!-- .entry-image end -->
                  <% end %>
                <% elsif post.select_media == 3 %> <!-- vimeo -->
                  <% if post.video_id.present? %>
                    <!-- Entry Video
                    ============================================= -->
                    <div class="entry-image">
    									<iframe src="https://player.vimeo.com/video/87701971" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                    </div><!-- .entry-image end -->
                  <% end %>
                <% end %>
~~~~~~~~

verifichiamo 

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails s -b $IP -p $PORT
~~~~~~~~














## Attiviamo la multilingua / internazionalizzazione



              <%= form.select :select_media, h_options_for_media, {}, prompt: t("application.company_status.one"), class: 'form-control' %>



{title=".../app/helpers/application_helper.rb", lang=ruby, line-numbers=on, starting-line-number=70}
~~~~~~~~
  def h_options_for_media
    [
      [t("application.company_status.one"),1],
      [t("application.company_status.two"),2],
      [t("application.company_status.three"),3],
      [t("application.company_status.four"),4],
      [t("application.company_status.five"),5],
      [t("application.company_status.six"),6],
      [t("application.company_status.seven"),7],
      [t("application.company_status.eight"),8]
    ]
  end
~~~~~~~~

implementiamo la traduzione in italiano

{title="config/locales/it.yml", lang=yaml, line-numbers=on, starting-line-number=27}
~~~~~~~~
  people:
    show:
      breadcrumbs: "Persona"
      
      'Scegline uno'
~~~~~~~~

implementiamo la traduzione in inglese

{title="config/locales/en.yml", lang=yaml, line-numbers=on, starting-line-number=27}
~~~~~~~~
  people:
    show:
      breadcrumbs: "Person"
      
      'Select One'
~~~~~~~~


aggiorniamo git 

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git add -A
$ git commit -m "add companies edit"
~~~~~~~~




## Per visualizzarlo

show
~~~~~~~~
      <%= content_tag :p,"#{h_company_status(@company.status)} - #{@company.sector}" %>
~~~~~~~~

helper
~~~~~~~~
  def h_company_status(status)
    status = 6 if status.blank?
    case status
    when 1
      #return t("application.company_status.one")
      return t("h.company_status_one")
    when 2
      return t("h.company_status_two")
    when 3
      return t("h.company_status_three")
    when 4
      return t("h.company_status_four")
    when 5
      return t("h.company_status_five")
    when 6
      return t("h.company_status_six")
    when 7
      return t("h.company_status_seven")
    when 8
      return t("h.company_status_eight")
    else
      raise "NON DOVEVI ARRIVARE QUI. Cosa succede?"
    end
  end
~~~~~~~~
