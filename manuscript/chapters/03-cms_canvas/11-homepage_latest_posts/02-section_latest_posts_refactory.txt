# Refactory per un codice più dry

Riscriviamo il codice in modo da ridurre le ripetizioni (Do not Repeat Yourself)




## Apriamo il branch "Refactory Homepage Latest Posts"

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout -b rhlp
~~~~~~~~




## Carichiamo gli ultimi 4 articoli nel controller

Prendiamo gli ultimi 4 posts e li carichiamo tutti su un'unica variabile di istanza da usare sulla nostra homepage.

{title=".../app/controllers/homepage_controller.rb", lang=ruby, line-numbers=on, starting-line-number=1}
~~~~~~~~
class HomepageController < ApplicationController
  def show
    @latest_posts = Post.last(4)
  end
end
~~~~~~~~




## Carichiamo gli ultimi 4 articoli nel view

Mettiamo gli ultimi quattro articoli nella nostra pagina ciclandoli con un loop.

{title=".../app/views/homepage/_section_blog.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=10}
~~~~~~~~
<% @latest_posts.each do |post| %>
  <div class="ipost col-md-6 bottommargin clearfix">
    <div class="row">
      <div class="col-lg-6">
        <div class="entry-image nobottommargin">
          <%= link_to post, target: "_blank" do %>
            <%= image_tag post.image_url, alt: @post.title %>
          <% end %>
        </div>
      </div>
      <div class="col-lg-6" style="margin-top: 20px;">
        <span class="before-heading" style="font-style: normal;"><%= @post.author.name %></span>
        <div class="entry-title">
          <h3 class="t400" style="font-size: 22px;"><%= link_to @post.title, @post %></h3>
        </div>
        <div class="entry-content">
          <!--<a href="#" class="more-link">Read more <i class="icon-angle-right"></i></a>-->
          <%= link_to @post, class: "more-link" do %>
            Read more <i class="icon-angle-right"></i>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
~~~~~~~~

Creando un loop ti rendi conto in maniera più evidente di cosa portare nel database.



verifichiamo che funziona tutto

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ sudo service postgresql start
$ rails s -b $IP -p $PORT
~~~~~~~~




## archiviamo su git

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git add -A
$ git commit -m "implement revolution slider beforeafter"
~~~~~~~~




## Publichiamo su heroku

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push heroku hlp:master
~~~~~~~~






## Chiudiamo il branch

se abbiamo finito le modifiche e va tutto bene:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout master
$ git merge hlp
$ git branch -d hlp
~~~~~~~~




## Facciamo un backup su Github

Dal nostro branch master di Git facciamo un backup di tutta l'applicazione sulla repository remota Github.

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push origin master
~~~~~~~~

