# Gli ultimi 4 articoli




## Apriamo il branch "Homepage Latest Posts"

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout -b hlp
~~~~~~~~




## Troviamo gli ultimi 4 records nel database

Possiamo usare gli indici negativi. Il penultimo record ha indice -2.

L'ultimo record (last):  Model.all[-1]
Il penultimo record (second_to_last):  Model.all[-2]
Il terzultimo record (third_to_last):  Model.all[-3]
Il decimultimo record (10th to last): Model.all[-10]

In Rails 5 the penultimate forms for [-2] and [-3] have aliases. So if you want, use this:

Model.second_to_last
Model.third_to_last

I> Another easier to remember way is: Model.last(2).first

I> Considerazioni importanti sulle prestazioni: https://www.varvet.com/blog/retrieving-the-last-n-ordered-records-with-activerecord/
I>
I> la morale dell'articolo di varvet è quella di guardare sempre l'SQL che viene creato da rails ed è lui che deve estrarre solo i records richiesti. 


{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails c
> Post.all[-1]
> Post.last
> Post.all[-2]
> Post.second_to_last
> Post.all[-3]
> Post.third_to_last
> Post.all[-4]
~~~~~~~~




## Carichiamo gli ultimi 4 articoli nel controller

Abbiamo visto come prendere gli ultimi 4 posts, adesso prepariamo 4 variabili di istanza da usare sulla nostra homepage.

{title=".../app/controllers/homepage_controller.rb", lang=ruby, line-numbers=on, starting-line-number=1}
~~~~~~~~
class HomepageController < ApplicationController
  def show
    @post1 = Post.all[-1]
    @post2 = Post.all[-2]
    @post3 = Post.all[-3]
    @post4 = Post.all[-4]
  end
end
~~~~~~~~

altra alternativa interessante è prendere gli ultimi 4 tutti con una sola query (da verificare chi performa meglio).

{title=".../app/controllers/homepage_controller.rb", lang=ruby, line-numbers=on, starting-line-number=1}
~~~~~~~~
class HomepageController < ApplicationController
  def show
    posts = Post.last(4)
    @post1 = posts[1]
    @post2 = posts[2]
    @post3 = posts[3]
    @post4 = posts[4]
  end
end
~~~~~~~~




## Carichiamo gli ultimi 4 articoli nel view

Mettiamo gli ultimi quattro articoli nella nostra pagina. Iniziamo con l'ultimo

{title=".../app/views/homepage/_section_blog.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=10}
~~~~~~~~
                <div class="ipost col-md-6 bottommargin clearfix">
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="entry-image nobottommargin">
                        <!-- <a href="#"><img src="images/blog/1.jpg" alt="Paris"></a> -->
                        <!-- <a href="#"><%#= image_tag @post1 "blog-1.jpg", alt: "Paris" %></a>-->
                        <%= link_to @post1, target: "_blank" do %>
                          <%= image_tag @post1.image_url, alt: @post1.title %>
                        <% end %>
                      </div>
                    </div>
                    <div class="col-lg-6" style="margin-top: 20px;">
                      <span class="before-heading" style="font-style: normal;"><%= @post1.author.name %></span>
                      <div class="entry-title">
                        <!--<h3 class="t400" style="font-size: 22px;"><a href="#">Global Meetup Program is Launching!</a></h3>-->
                        <h3 class="t400" style="font-size: 22px;"><%= link_to @post1.title, @post1 %></h3>
                      </div>
                      <div class="entry-content">
                        <!--<a href="#" class="more-link">Read more <i class="icon-angle-right"></i></a>-->
                        <%= link_to @post1, class: "more-link" do %>
                          Read more <i class="icon-angle-right"></i>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
~~~~~~~~





verifichiamo che funziona tutto

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ sudo service postgresql start
$ rails s -b $IP -p $PORT
~~~~~~~~




## archiviamo su git

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git add -A
$ git commit -m "implement revolution slider beforeafter"
~~~~~~~~




## Publichiamo su heroku

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push heroku hlp:master
~~~~~~~~






## Chiudiamo il branch

se abbiamo finito le modifiche e va tutto bene:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout master
$ git merge hlp
$ git branch -d hlp
~~~~~~~~




## Facciamo un backup su Github

Dal nostro branch master di Git facciamo un backup di tutta l'applicazione sulla repository remota Github.

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push origin master
~~~~~~~~

