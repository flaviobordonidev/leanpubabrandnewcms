# PostgreSQL

Attiviamo postgreSQL ed effettuiamo la connessione creando i databases




## Gestiamo l'errore

L'errore è perché PostgreSQL non trova i databases di svilluppo e di test. Questi sono definiti sul file /config/database.yml

Come si vede sul database.yml di postgresql diamo il nome dei database con la convenzione "nome-applicazione + _development (o _test)" 
Non creiamo il database di produzione (_production) perché la produzione la teniamo su heroku.

![Fig. b]()

[codice a](#beginning/new_app/03a-config-database.yml)

{title=".../config/database.yml", lang=yaml, line-numbers=on, starting-line-number=24}
~~~~~~~~
development:
  <<: *default
  database: rigenerabatterie_development
~~~~~~~~

{title=".../config/database.yml", lang=yaml, line-numbers=on, starting-line-number=58}
~~~~~~~~
test:
  <<: *default
  database: rigenerabatterie_test
~~~~~~~~

{title=".../config/database.yml", lang=yaml, line-numbers=on, starting-line-number=81}
~~~~~~~~
production:
  <<: *default
  database: rebisworld_production
  username: rebisworld
  password: <%= ENV['REBISWORLD_DATABASE_PASSWORD'] %>
~~~~~~~~

I> la configurazione del database di produzione la cambieremo più avanti perché usiamo Heroku e non il server locale.

verifichiamo che non c'è comunicazione eseguendo

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails db:migrate
~~~~~~~~

Prende errore perché non esistono ancora i databases.

Creiamo i databases sul postgreSQL del workspace di cloud9.
Il servizio postgresql è gia attivo quindi creiamo i databases solo per development e test

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ createdb rigenerabatterie_development
$ createdb rigenerabatterie_test
~~~~~~~~

verifichiamo che adesso c'è comunicazione eseguendo

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails db:migrate
~~~~~~~~

Il comando adesso non da nessun errore.




## Verifichiamo i databases creati da linea di comando di pg

Per verificare i databases dalla linea di comando di PostgreSQL:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ psql
postgres=# \list
postgres=# \q

oppure

$ psql --list
~~~~~~~~

Avremmo potuto creare i databases anche da dentro la linea di comando di postgreSQL:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rails s -b $IP -p $PORT

$ psql
postgres=# CREATE DATABASE "elisinfo5_development";
postgres=# CREATE DATABASE "elisinfo5_test";
postgres=# \list
postgres=# \q
~~~~~~~~

I> ATTENZIONE
I>
I> il database ha encoding: SQL_ASCII quindi non supporta caratteri accentato come invece fa UTF8
I>
I> Probabilmente è bene cambiare encoding...


verifichiamo che c'è comunicazione eseguendo

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ rake db:migrate
~~~~~~~~

Va a buon fine quindi non è necessario impostare un utente ed una password per il database. Quelle impostate in automatico di default vanno bene.

Verifichiamo sul web

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ cd elisinfo
$ rails s
~~~~~~~~

![Fig. b](beginning/new_app/03b-preview-app_working.png)
