# Visualizziamo dinamicamente l'elenco dei contatti sulla homepage



## Apriamo il branch "homepage contacts"

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout -b hc
~~~~~~~~




## Implementiamo i contatti nell'homepage controller

Usiamo la variabile d'istanza @relateds e gli passiamo tutte i contatti ** @relateds = Contact.all **. Siccome l'istanza è per varie entità metto un ** case params[:related] ** per passare di volta in volta l'entità richiesta.

{title=".../app/controllers/select_relateds_controller.rb", lang=ruby, line-numbers=on, starting-line-number=8}
~~~~~~~~
class HomepageController < ApplicationController

  before_action :authenticate_user!

  def index
    # current_user is generated by the gem "devise" and contain the logged user. es: User.find(current_user.id)
    @user = current_user
    
    # inizializziamo i parametri per il "go_back"
    params[:locale] = "it" if params[:locale].blank?
    params[:last_front_controller] = "homepage" if params[:last_front_controller].blank?
    params[:last_front_action] = "index" if params[:last_front_action].blank?
    params[:related] = "favorites" if params[:related].blank?
    params[:page] = 1 if params[:page].blank?

    # gestiamo l'elenco dei relateds
    case params[:related]
    when "favorites"
      # TODO
    when "people"
      @relateds = Person.all
    when "companies"
      @relateds = Company.all
    when "contacts"
      @relateds = Contact.all
    else
      raise "#TODO"
    end
    
  end
  
end
~~~~~~~~

usiamo questa variabile per chiamare il partial con la lista dei contatti **  <%= render "#{params[:related]}/index_list_group" %> **

e creiamo il partial nell'entità di competenza. In questo caso nei contatti (contacts).

{title=".../app/views/contacts/_index_list_group.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=4}
~~~~~~~~
<div class="list-group left-pad right-pad">
  <% @relateds.each do |contact| %>
    <%= link_to url_for(h_params_path(path: "/contacts/#{contact.id}", related: "favorites", page: 1, last_front_controller: "contacts", last_front_id: contact.id)), :class => "list-group-item" do %>
      <%# unless contact.favorite_id_user.blank? %>
        <span class="badge"><span class="glyphicon glyphicon-star"></span></span>
      <%# end %>
      <p> <%= contact.medium %> </p>
      <p><strong> <%= "#{contact.identifier}"%> </strong></p>
    <% end %>
  <% end %>
</div>
~~~~~~~~


verifichiamo che funziona tutto 

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ sudo service postgresql start
$ rails s -b $IP -p $PORT
~~~~~~~~

https://elisinfo5-flaviobordonidev.c9users.io/select_relateds


{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git add -A
$ git commit -m "add homepage related people"
~~~~~~~~




## Publichiamo su heroku

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push heroku hp:master

$ heroku run rake db:migrate
~~~~~~~~




## Chiudiamo il branch

se abbiamo finito le modifiche e va tutto bene:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout master
$ git merge hp
$ git branch -d hp
~~~~~~~~
