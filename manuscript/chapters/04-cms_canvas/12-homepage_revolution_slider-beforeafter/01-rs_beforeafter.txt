# Revolution Slider beforeafter

Implementiamo http://themes.semicolonweb.com/html/canvas/rs-demo-premium-beforeafter.html nella nostra homepage



## Apriamo il branch "Revolution Slider BeforeAfter Stylesheets e Javascripts"

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout -b rsbasj
~~~~~~~~




## Isoliamo il codice per far funzionare il revolution slider

apriamo il file HTML/rs-demo-premium-beforeafter.html ed iniziamo ad isolarci le sole parti legate al revolution slider.
La parte che va nell' <HEAD>

{title="", lang=HTML+Mako, line-numbers=on, starting-line-number=20}
~~~~~~~~
    <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->

    <!-- SLIDER REVOLUTION 5.x CSS SETTINGS -->
    <link rel="stylesheet" type="text/css" href="include/rs-plugin/css/settings.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="include/rs-plugin/css/layers.css">
    <link rel="stylesheet" type="text/css" href="include/rs-plugin/css/navigation.css">

    <!-- ADD-ONS CSS FILES -->
    <link rel="stylesheet" type="text/css" href="include/rs-plugin/css/addons/revolution.addon.beforeafter.css">
    <link rel="stylesheet" type="text/css" href="include/rs-plugin/css/addons/revolution.addon.particles.css">
~~~~~~~~

Incluso lo <style>

{title="", lang=HTML+Mako, line-numbers=on, starting-line-number=37}
~~~~~~~~
    <style>

        .demos-filter {
            margin: 0;
            text-align: right;
        }
  .
  .
  .
~~~~~~~~

il codice dello slider

{title="", lang=HTML+Mako, line-numbers=on, starting-line-number=737}
~~~~~~~~
        <!-- Slider
        ============================================= -->
        <section id="slider" class="slider-element revslider-wrap clearfix">

            <div id="rev_slider_77_1_wrapper" class="rev_slider_wrapper fullwidth-container" data-alias="beforeafterslider1" data-source="gallery" style="background:#252525;padding:0px;">
                <!-- START REVOLUTION SLIDER 5.4.5 fullscreen mode -->
        .
        .
        .
~~~~~~~~

e la parte javascripts dei file esterni <script>

{title="", lang=HTML+Mako, line-numbers=on, starting-line-number=1595}
~~~~~~~~
    <!-- SLIDER REVOLUTION 5.x SCRIPTS  -->
    <script src="include/rs-plugin/js/jquery.themepunch.tools.min.js"></script>
    <script src="include/rs-plugin/js/jquery.themepunch.revolution.min.js"></script>
    <!-- SLIDER REVOLUTION ADDONS  -->
    <script src="include/rs-plugin/js/addons/revolution.addon.beforeafter.min.js"></script>
    <script src="include/rs-plugin/js/addons/revolution.addon.particles.min.js"></script>
    <!-- SLIDER REVOLUTION EXTENSIONS  -->
    <script src="include/rs-plugin/js/extensions/revolution.extension.actions.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.carousel.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.kenburn.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.layeranimation.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.migration.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.navigation.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.parallax.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.slideanims.min.js"></script>
    <script src="include/rs-plugin/js/extensions/revolution.extension.video.min.js"></script>
~~~~~~~~

e la parte javascripts e del codice in linea <script>

{title="", lang=HTML+Mako, line-numbers=on, starting-line-number=1612}
~~~~~~~~
    <!-- ADD-ONS JS FILES -->
    <script>
        var revapi77,
        tpj=jQuery;
    .
    .
    .
~~~~~~~~




## Prepariamo il partial

Per la parte di codice che va nel <HEAD> prepariamo un **provide** per lo **yield** ed adattiamo le chiamate ai files .css per gestire l'asset_pipeline

{title=".../app/views/homepage/_slider_revolution.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=7}
~~~~~~~~
<% provide :slider_revolution_beforeafter_stylesheets do %>
    <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->

    <!-- SLIDER REVOLUTION 5.x CSS SETTINGS -->
    <!--<link rel="stylesheet" type="text/css" href="include/rs-plugin/css/settings.css" media="screen" />-->
    <%= stylesheet_link_tag 'rs-plugin-css-settings', media: 'all', 'data-turbolinks-track': 'reload' %>
    <!--<link rel="stylesheet" type="text/css" href="include/rs-plugin/css/layers.css">-->
    <%= stylesheet_link_tag 'rs-plugin-css-layers', media: 'all', 'data-turbolinks-track': 'reload' %>
    <!--<link rel="stylesheet" type="text/css" href="include/rs-plugin/css/navigation.css">-->
    <%= stylesheet_link_tag 'rs-plugin-css-navigation', media: 'all', 'data-turbolinks-track': 'reload' %>

    <!-- ADD-ONS CSS FILES -->
    <!--<link rel="stylesheet" type="text/css" href="include/rs-plugin/css/addons/revolution.addon.beforeafter.css">-->
    <%= stylesheet_link_tag 'rs-plugin-css-revolution.addon.beforeafter', media: 'all', 'data-turbolinks-track': 'reload' %>
    <!--<link rel="stylesheet" type="text/css" href="include/rs-plugin/css/addons/revolution.addon.particles.css">-->
    <%= stylesheet_link_tag 'rs-plugin-css-revolution.addon.particles', media: 'all', 'data-turbolinks-track': 'reload' %>
  .
  .
  .
<% end %>
~~~~~~~~

Attiviamo lo yield nel layout application

{title=".../app/views/layouts/application.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=29}
~~~~~~~~
    <%= yield(:slider_revolution_beforeafter_stylesheets) %>
~~~~~~~~



Per la parte di codice javascripts che va nel <script> prepariamo un **provide** per lo **yield** ed adattiamo le chiamate ai files .js per gestire l'asset_pipeline

{title=".../app/views/homepage/_slider_revolution.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=7}
~~~~~~~~
~~~~~~~~

Attiviamo lo yield nel layout application

{title=".../app/views/layouts/application.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=49}
~~~~~~~~
    <%= yield(:slider_revolution_beforeafter_javascripts) %>
~~~~~~~~




## importiamo i files da Canvas nell'asset_pipeline

E' arrivato il momento di importare i files dal template Canvas nella nostra app Rails (da -> a). Seguiamo l'ordine delle chiamate sul file st_homepage. Siccome sul file st_homepage le chamate sono a codice stylesheets css inizialmente uso questo.

* HTML/include/rs-plugin/css/settings.css                               ->  .../app/assets/stylesheets/rs-plugin-css-settings.css (rinominato)
* HTML/include/rs-plugin/css/layers.css                                 ->  .../app/assets/stylesheets/rs-plugin-css-layers.css (rinominato)
* HTML/include/rs-plugin/css/navigation.css                             ->  .../app/assets/stylesheets/rs-plugin-css-navigation.css (rinominato)
* HTML/include/rs-plugin/css/addons/revolution.addon.beforeafter.css    ->  .../app/assets/stylesheets/rs-plugin-css-revolution.addon.beforeafter.css (rinominato)
* HTML/include/rs-plugin/css/addons/revolution.addon.particles.css      ->  .../app/assets/stylesheets/rs-plugin-css-revolution.addon.particles.css (rinominato)

* HTML/include/rs-plugin/js/jquery.themepunch.tools.min.js                        ->  .../app/assets/javascripts/rs-plugin-js-jquery.themepunch.tools.min.js (rinominato)
* HTML/include/rs-plugin/js/jquery.themepunch.revolution.min.js                   ->  .../app/assets/javascripts/rs-plugin-js-jquery.themepunch.revolution.min.js (rinominato)
* HTML/include/rs-plugin/js/addons/revolution.addon.beforeafter.min.js            ->  .../app/assets/javascripts/rs-plugin-js-revolution.addon.beforeafter.min (rinominato)
* HTML/include/rs-plugin/js/addons/revolution.addon.particles.min.js              ->  .../app/assets/javascripts/rs-plugin-js-revolution.addon.particles.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.actions.min.js        ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.actions.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.carousel.min.js       ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.carousel.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.kenburn.min.js        ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.kenburn.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.layeranimation.min.js ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.layeranimation.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.migration.min.js      ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.migration.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.navigation.min.js     ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.navigation.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.parallax.min.js       ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.parallax.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.slideanims.min.js     ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.slideanims.min.js (rinominato)
* HTML/include/rs-plugin/js/extensions/revolution.extension.video.min.js          ->  .../app/assets/javascripts/rs-plugin-js-revolution.extension.video.min.js (rinominato)




## Chiamate all'asset_pipeline

Poiché abbiamo tolto nel views/layouts/application.html.erb le chiamate all'asset_pipeline.

{title=".../app/views/layouts/application.html.erb", lang=HTML+Mako, line-numbers=on, starting-line-number=7}
~~~~~~~~
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
~~~~~~~~

Senza queste chiamate non accediamo ai files manifest dell'asset_pipeline (assets/stylesheets/application.css e assets/javascripts/application.js)
Se proviamo una volta copiati i files riceviamo errore. Invece di passare per i files manifest, aggiungiamo le nostre chiamate ai files direttamente nel precompile. 

{title=".../config/application.rb", lang=ruby, line-numbers=on, starting-line-number=21}
~~~~~~~~
    # precompile assets stylesheets                                                             
    config.assets.precompile += ['bootstrap.css',
                                 'style.css',
                                 'onepage.css',
                                 'dark.css',
                                 'font-icons.css',
                                 'et-line.css',
                                 'animate.css',
                                 'magnific-popup.css',
                                 'fonts.css',
                                 'responsive.css',
                                 'rs-plugin-css-settings.css',
                                 'rs-plugin-css-layers.css',
                                 'rs-plugin-css-navigation.css',
                                 'rs-plugin-css-revolution.addon.beforeafter.css',
                                 'rs-plugin-css-revolution.addon.particles.css'
                                ]

    # precompile assets javascripts                                                             
    config.assets.precompile += ['jquery.js',
                                 'plugins.js',
                                 'jquery.gmap.js',
                                 'functions.js',
                                 'rs-plugin-js-jquery.themepunch.tools.min.js',
                                 'rs-plugin-js-jquery.themepunch.revolution.min.js',
                                 'rs-plugin-js-revolution.addon.beforeafter.min',
                                 'rs-plugin-js-revolution.addon.particles.min.js',
                                 'rs-plugin-js-revolution.extension.actions.min.js',
                                 'rs-plugin-js-revolution.extension.carousel.min.js',
                                 'rs-plugin-js-revolution.extension.kenburn.min.js',
                                 'rs-plugin-js-revolution.extension.layeranimation.min.js',
                                 'rs-plugin-js-revolution.extension.migration.min.js',
                                 'rs-plugin-js-revolution.extension.navigation.min.js',
                                 'rs-plugin-js-revolution.extension.parallax.min.js',
                                 'rs-plugin-js-revolution.extension.slideanims.min.js',
                                 'rs-plugin-js-revolution.extension.video.min.js'
                                ]
~~~~~~~~

Così funziona ma non stiamo seguendo la convenzione Rails dell'asset_pipeline che prevede di passare per i files manifest. Quindi in seguito faremo un refactoring. Durante il refactoring sostituiremo le varie chiamate fatte sull'<head> di views/st_homepage/index ai files stylesheets con la sola chiamata al file manifest assets/stylesheets/application.css e configureremo le chiamate nel file manifest invece di inserirle direttamente nel precompile.

Attenzione!
Modificando application.rb è necessario riavviare il server rails (rails s ...) per includere le modifiche.

verifichiamo che funziona tutto

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ sudo service postgresql start
$ rails s -b $IP -p $PORT
~~~~~~~~

Il postgresql start possiamo anche non eseguirlo perché al momento non usiamo il database.




## I Fonts

le freccette di navigazione in basso si presentano come dei quadrati perché ci manca di caricare i Fonts.
Dentro rs-plugin-css-settings.css ci sono le chiamate ai fonts **../fonts/revicons/revicons.xxx**

copiamoci i fonts:

* HTML/include/rs-plugin/fonts/revicons/revicons.eot	->  .../app/assets/stylesheets/fonts/revicons.eot
* HTML/include/rs-plugin/fonts/revicons/revicons.svg	->  .../app/assets/stylesheets/fonts/revicons.svg
* HTML/include/rs-plugin/fonts/revicons/revicons.ttf	->  .../app/assets/stylesheets/fonts/revicons.ttf
* HTML/include/rs-plugin/fonts/revicons/revicons.woff	->  .../app/assets/stylesheets/fonts/revicons.woff

e cambiamo il percorso nel file rs-plugin-css-settings.css è tutto su una linea ma riusciamo facilmente a cambiare da

**../fonts/revicons/revicons.xxx**

a

**fonts/revicons.xxx**




## Implementiamo i fonts per Heroku

Cambiamo tutte le chiamate url(...) con l'helper rails font-url(...)

I> ATTENZIONE: assicurati di usare **.scss**

Se lasciamo rs-plugin-css-settings.css riceveremo un errore in fase di precompile di heroku perché l'helper font-url(...) non è riconosciuto come un comando css valido. Per usarlo dobbiamo usare SASS/scss quindi rinominare il file:

* da rs-plugin-css-settings.css
* a  rs-plugin-css-settings.scss

da
~~~~~~~~
src:url(fonts/revicons.eot?5510888);src:url(fonts/revicons.eot?5510888#iefix) format('embedded-opentype'),url(fonts/revicons.woff?5510888) format('woff'),url(fonts/revicons.ttf?5510888) format('truetype'),url(fonts/revicons.svg?5510888#revicons) format('svg')
~~~~~~~~

a
~~~~~~~~
src:font-url('fonts/revicons.eot?5510888');src:font-url('fonts/revicons.eot?5510888#iefix') format('embedded-opentype'),font-url('fonts/revicons.woff?5510888') format('woff'),font-url('fonts/revicons.ttf?5510888') format('truetype'),font-url('fonts/revicons.svg?5510888#revicons') format('svg')
~~~~~~~~

Attenzione l'argomento di font-url è bene metterlo tra virgolette font-url('...')




## archiviamo su git

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git add -A
$ git commit -m "implement revolution slider beforeafter"
~~~~~~~~




## Publichiamo su heroku

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push heroku rsbasj:master
~~~~~~~~




## Corretti filese di canvas

i files di stilesheets del tema Canvas avevano 3 errori:

ERRORE 1

{title=".../app/assets/stilesheets/rs-plugin-css-layers.css", lang=ruby, line-numbers=on, starting-line-number=5651}
~~~~~~~~
        filter: progid: DXImageTransform.Microsoft.gradient( startColorstr='#d9000000', endColorstr='#00000000', GradientType=0);
~~~~~~~~

c'era uno spazio errato dopo progid: che abbiamo corretto.

{title=".../app/assets/stilesheets/rs-plugin-css-layers.css", lang=ruby, line-numbers=on, starting-line-number=5651}
~~~~~~~~
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d9000000', endColorstr='#00000000', GradientType=0);
~~~~~~~~

errore notato vedendo altre chiamate filter: progid... sul file .../app/assets/stilesheets/rs-plugin-css-settings.css


ERRORE 2

{title=".../app/assets/stilesheets/rs-plugin-css-navigation.css", lang=ruby, line-numbers=on, starting-line-number=761}
~~~~~~~~
    font-family:"Roboto Slab"
~~~~~~~~

manca il ";" finale.

{title=".../app/assets/stilesheets/rs-plugin-css-navigation.css", lang=ruby, line-numbers=on, starting-line-number=761}
~~~~~~~~
    font-family:"Roboto Slab";
~~~~~~~~


ERRORE 3

stesso errore di prima ma più avanti nel file

{title=".../app/assets/stilesheets/rs-plugin-css-navigation.css", lang=ruby, line-numbers=on, starting-line-number=1422}
~~~~~~~~
    font-family:"Roboto Slab"
~~~~~~~~

manca il ";" finale.

{title=".../app/assets/stilesheets/rs-plugin-css-navigation.css", lang=ruby, line-numbers=on, starting-line-number=1422}
~~~~~~~~
    font-family:"Roboto Slab";
~~~~~~~~




## Chiudiamo il branch

se abbiamo finito le modifiche e va tutto bene:

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git checkout master
$ git merge rsbasj
$ git branch -d rsbasj
~~~~~~~~




## Facciamo un backup su Github

Dal nostro branch master di Git facciamo un backup di tutta l'applicazione sulla repository remota Github.

{title="terminal", lang=bash, line-numbers=off}
~~~~~~~~
$ git push origin master
~~~~~~~~

